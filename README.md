## Проект "BestJob"
## Командная разработка по методологии Agile:Scrum
GB 3.1 dev BestPy group job search exhibition project
### Базовая документация к проекту

Основные системные требования:
* Ubuntu 22.04 LTS
* Python 3.10.4
* Django 4.0.4
* Зависимости (Python) из requirements.txt

ОБЩИЕ СВЕДЕНИЯ О ЗАКАЗЧИКЕ:
Компания N - это известное рекрутинговое агентство в IT-сфере, оказывающее услуги по поиску и подбору IT-персонала для организаций. Несколько лет компания успешно работала через прием прямых заявок от организаций и последующий поиск специалистов с помощью менеджеров по рекрутингу. Значительный рост спроса на услуги агентства сформировал потребность в автоматизации процесса и создании единой платформы, которая станет связующим звеном между работодателем и соискателем.

ЦЕЛИ И ЗАДАЧИ ВЫПОЛНЯЕМЫХ РАБОТ:
Необходимо создать рекрутинговый интернет-портал по аналогии с hh.ru, который позволит связать между собой сотрудников, ищущих работу и работодателей, которые ищут подходящих сотрудников по средствам размещения и подбора вакансий и резюме. 

Задачи проекта:
В рамках проекта должны быть оказаны услуги по разработке:
-	Архитектуры приложения
-	Архитектуры БД 
-	Базовой вёрстки сайта (упор в проекте на backend, а не на frontend)
-	Функциональности, описанной далее:

➔	Главная страница, которая дает возможность зарегистрироваться или пройти авторизацию, просмотреть список компаний партнеров или пролистать ленту новостей. 
➔	Зарегистрированному пользователю в зависимости от роли становится доступна страница с базой данных по вакансиям или резюме.
➔	У зарегистрированного пользователя должен быть личный кабинет с необходимым набором функций в зависимости от роли.
➔	Административная панель для осуществления модерации.

ОПИСАНИЕ РОЛЕЙ:
На сайте должны быть реализованы следующие роли:
1.	Неавторизованный пользователь. Может прочитать описание портала, просмотреть ленту новостей, просмотреть список компаний партнеров, заполнить форму авторизации или пройти регистрацию.
2.	Сотрудник. Зарегистрированный пользователь, который может размещать и управлять одним или несколькими своими резюме, имеет доступ к базе вакансий и возможность откликнуться.
3.	Работодатель. Зарегистрированный пользователь, которому доступно заполнение карточки компании, размещение вакансии и работа с базой резюме IT-специалистов.
4.	Модератор. Проводит пост-модерацию карточек компаний/вакансий/резюме. Может размещать новости на портале.

ФУНКЦИОНАЛЬНОЕ ОПИСАНИЕ:
●	Регистрации и авторизации пользователей с обязательным выбором роли участника и предоставляемой формой для заполнения, в зависимости от выбранной роли.
●	Размещения резюме, с возможностью заполнить/редактировать/сохранять как черновик личные данные, весь опыт работы, а также образование, дополнительные сертификаты и курсы в хронологическом порядке.
●	Просмотр своих откликов на вакансии и статус по ним.
●	Просмотр предложений от работодателя и возможность ответить на них.
●	Размещения карточки компании с возможностью заполнять/редактировать подробную информацию о компании и приветственное письмо, которое отображается в самом начале карточки компании.
●	Создание и размещения вакансий компаниями, которые прошли проверку модераторами.
●	Просмотр предложений по вакансиям и статус по ним.
●	Просмотр откликов от пользователей-сотрудников с возможностью ответить на них.
●	Функционал полной пост-модерации вакансий, размещенных компанией.
●	Функционал простого и расширенного поиска вакансий или резюме, в зависимости от роли авторизованного пользователя с возможностью добавления в избранное.
●	Функционал отправки резюме на выбранную вакансию.
●	Функционал отправки предложения о вакансии на выбранное резюме.
●	Новостной портал для продвижения сайта в поисковых системах.

ВЗАИМОДЕЙСТВИЕ ПОЛЬЗОВАТЕЛЕЙ С СИСТЕМОЙ:
Сценарии использования 1 
Незарегистрированный пользователь-сотрудник заходит на сайт, просматривает главную страницу, читает описание и правила портала, просматривает ленту новостей и список компаний партнеров. Решает пройти регистрацию, сайт предлагает ему выбрать роль и заполнить обязательные поля. После авторизации пользователь-сотрудник попадает на страницу с базой данных по вакансиям и возможностью перехода в личный кабинет для заполнения резюме. Воспользовавшись расширенным поиском пользователь просматривает вакансии, выбрав одну из них пытается откликнуться на вакансию, сайт сообщает ему: “Нет доступных резюме для отклика на вакансию. Создайте резюме в личном кабинете.” Пользователь-сотрудник добавляет выбранную вакансию в избранное и переходит в ЛК, где по предложенной сайтом форме заполняет резюме, но решает его не публиковать, а сохранить в черновик, чтобы вернуться к нему позже. Выходит из личного кабинета и попадает на главную страницу с формой авторизации.

Сценарии использования 2
Незарегистрированный пользователь-работодатель заходит на сайт, просматривает главную страницу, читает описание и правила портала, просматривает ленту новостей и список компаний партнеров. Решает пройти регистрацию, сайт предлагает ему выбрать роль и заполнить обязательные поля. После авторизации пользователь-работодатель попадает на страницу с базой данных по резюме и возможностью перехода в личный кабинет для заполнения карточки компании и предлагаемых вакансий. Воспользовавшись расширенным поиском пользователь-работодатель просматривает резюме, выбрав одно из них пытается связаться с соискателем, сайт  выводит сообщение: “Нет доступных вакансий для отклика на резюме. Создайте вакансии в личном кабинете”. Пользователь переходит в ЛК, где по предложенной сайтом форме заполняет карточку компании  и вакансию, отправляет на утверждение модератору с последующей публикацией. Выходит из личного кабинета и попадает на главную страницу с формой авторизации.

Сценарии использования 3
Пользователь-сотрудник заходит на сайт под своим профилем, переходит в личный кабинет, редактирует сохраненное в черновиках резюме, нажимает на кнопку опубликовать. Переходит на страницу поиска вакансий, выбирает раздел избранное, из списка выбирает необходимую вакансию и нажимает на кнопку откликнуться, сайт предлагает ему выбрать необходимое резюме и отправить работодателю. В личном кабинете должен появится список откликов на вакансии с возможностью отслеживать статус и в случае положительного ответа от работодателя должна появится форма обратной связи.

Сценарии использования 4
Пользователь-работодатель заходит на сайт под своим профилем. Переходит на страницу поиска резюме, выбирает раздел избранное, из списка выбирает необходимое резюме и нажимает на кнопку “отправить предложение о вакансии”, сайт предлагает ему выбрать необходимую вакансию и отправить пользователю-сотруднику. В личном кабинете должен появится список отправленных предложений с возможностью отслеживать статус и в случае положительного ответа от соискателя должна появится форма обратной связи.

Сценарий использования 5
Модератор заходит на сайт, попадает на панель управления куда выводятся все новые уведомления о поступивших на согласование корточках компаний и вакансий. Проверяет, часть карточек/вакансий получают статус одобрено/опубликовано, часть отправляется на доработку с комментариями.

### Установка необходимого ПО
#### обновляем информацию о репозиториях
```
apt update
```
#### Установка nginx, virtualenv
nginx
```
apt install nginx
```
virtualenv
```
apt install python3-venv
```
#### Готовим директории для проекта
Создаем директорию для хранения статики:
```
mkdir /var/www/bestjob
mkdir /var/www/bestjob/static
```
Создаем пользователя для проекта и переходим в дирректорию пользователя:
```
useradd -g www-data -m django
cd /home/django/ 
```
www-data - название группы, а django - имя пользователя. Могут быть произвольными, но в случае использования других вариантов нужно учитывать эти данные в дальнейшем.

Создаем ssh-ключ для репозитория командой:
```
ssh-keygen
```
Извлекаем ключ для добавления его в репозиторий в качестве Deploy key:
```
cat /root/.ssh/id_rsa.pub
```
Данный ключ в настройках проекта на git нужно добавить как Deploy key. Это нужно для того, чтобы не вводить пароль от git каждый раз при обращении к репозиторию.

###Важно!!! 
```
Потребуется минимальная подготовка репозитория. 
В файле settings.py нужно выполнить следующие действия:
1) В переменную DOMAIN_NAME впишите ссылку на будущий сайт
2) Раскомментируйте строку с переменной STATIC_ROOT
3) Если требуется, поменяйте значение переменной DEBUG
В нашем случае мы использовали адрес в виде ip сервера:
http://80.78.247.147
Также потребуется внести правку в файл Nginx в третью строку
server_name 80.78.247.147;
Укажите нужное имя сервера
```
После добавления ключа скопируйте информацию для клонирования вашего репозитория по SSH, после чего запустите клонирование. 

Клонирование проекта :
```
git clone git@github.com:Necris45/gb_31_best_py.git
```
Перейдите в корневой каталог проекта:
```
cd gb_31_best_py/
```
При необходимости поменяйте ветку:
```
git checkout <branch_name>
```
Сделайте подготовленные скрипты исполняемыми:
```
chmod +x ./deploy.sh
chmod +x ./update.sh
chmod +x ./restart.sh
```
Запустите скрипт deploy.sh
```
./deploy.sh
```
Будьте внимательны, будет использовано автозаполнение тестовыми данными, который потом нужно проиндексировать.
Когда система задаст вопрос, согласитесь. В дальнейшем тестовые данные можно будет удалить, но с ними будет удобнее проверить работоспособность сайта.
После выполнения скрипта сайт будет работать, но для работы отправки писем новым пользователям нужно будет произвести некоторые настройки.

Для настройки отправки писем новым пользователям нужен будет почтовый ящик. Для примера мы использовали ящик на mail.ru и для его работы нужно получить ключ приложения, который будет использоваться в качестве пароля.

Для создания файла с настройками почты удостоверьтесь что вы находитесь в следующей дирректории (/home/django/gb_31_best_py/BestJob) используйте команду:
```
nano .env
```
В открывшемся окне редактора Nano скопируйте следующее:
```
EMAIL_HOST = 'smtp.mail.ru'
EMAIL_PORT = 465
EMAIL_HOST_USER = 'your mail'
EMAIL_HOST_PASSWORD = 'your password'
EMAIL_USE_TLS = False
EMAIL_USE_SSL = True
```
В переменные EMAIL_HOST_USER и EMAIL_HOST_PASSWORD укажите данные почтового ящика.
Если используете ящик не от mail.ru, то обратитесь к техподдержке и получите настройки для соответствующего почтового сервера.
После внесения всех изменений сохраняем файл и выполняем скрипт для перезапуска сервера с новыми настройками.
```
./restart.sh
```
Данный скрипт нужно использовать также после обновления сайта из репозитория.

#### Суперпользователь
Создайте администратора используя команду и введите всю требуемую информацию:
```
python3 manage.py createsuperuser
```
Теперь вы можете войти в админку сайта с использованием введенного в процессе создания логина и пароля. Теперь сайт полностью готов к работе.

#### Обновления сайта
В дальнейшем если Вам будет необходимо обновить данные на сайте (раширите функционал или внесете изменения в дизайн) вам потребуется после подключения к серверу выполнить команду `cd /home/django/gb_31_best_py/BestJob/` и далее в зависимости от способа внесении изменений выполнить соответствующий скрипт.
Для обновления через загрузку изменений из репозитория:
`./update.sh`

Если правки были внесены в настройки проекта вручную, то нужно просто перезапустить nginx и gunicorn скриптом `./restart.sh`

### Autotests
Функционал покрыт автотестами и ниже показаны способы их запуска.

Запуск автотестов из директории проекта - `python -m pytest -v -m all tests/`

Прогон по меткам:
`python -m pytest -v -m 'all and urls and not negative' tests/`

### Allure
Документация на allure: 
`https://docs.qameta.io/allure/#_installing_a_commandline`
Для отображения UI отчёта необходимо установить allure:
```
apt-add-repository ppa:qameta/allure
apt-get update 
apt-get install allure
```
Запуск с формированием allure отчета
`python -m pytest --alluredir=allure_reports -v -m all tests/` где allure_reports - имя для временной папки с отчетами

Запуск сервера allure для просмотра результатов тестов 
`allure serve allure_reports/`
